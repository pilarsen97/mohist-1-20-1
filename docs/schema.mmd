flowchart LR
%% ====== Internet side ======
U[User / Internet] -->|HTTPS 80/443| VPS[VPS: Public IP\nUbuntu 24.04]
U -->|TCP 25565 (Minecraft Java)| VPS
U -->|TCP 22 (SSH keys)| VPS

%% ====== VPS services ======
subgraph VPSBOX[VPS]
NPM[Nginx Proxy Manager\n:80/:443]
SSHD[OpenSSH\n:22]
WGvps[WireGuard (server)\nwg0: 10.10.0.1/24]
end

VPS --> NPM
VPS --> SSHD
VPS --> WGvps

%% ====== Secure tunnel ======
WGvps ---|Encrypted tunnel| WGpve[WireGuard (client)\nwg0: 10.10.0.2/24]

%% ====== Home / Proxmox LAN ======
subgraph HOME[Home LAN 192.168.1.0/24]
PVE[Proxmox host\n192.168.1.200\n(WG client here)]
VM100[VM 100 MCserver\n192.168.1.201]
VM101[VM 101 prom-graf\n192.168.1.202]
VM104[VM 104 Portainer\n192.168.1.204]
end

WGpve --> PVE

%% ====== HTTP(S) via NPM ======
NPM -->|grafana.pilarsen.ru → 192.168.1.202:3000| VM101
NPM -->|server.kibermine.ru → 192.168.1.201:8123 (Dynmap)| VM100
%% Optional future: portainer via VPN only (no public host)
%% NPM -->|portainer.pilarsen.ru → 192.168.1.204:9000 (VPN-only)| VM104

%% ====== Non-HTTP ports (direct on VPS, forwarded via WG) ======
VPS -->|TCP 25565 → 192.168.1.201:25565| VM100
VPS -->|TCP 24454 → 192.168.1.201:24454| VM100
VPS -->|TCP 25575 (RCON?) → 192.168.1.201:25575| VM100
VPS -->|TCP 36123 → 192.168.1.201:36123| VM100

%% ====== SSH access pattern ======
SSHD -->|SSH keys (devops)\nvia WG to LAN| VM100

%% ====== Access policy notes ======
classDef public fill:#fff,stroke:#333,stroke-width:1px;
classDef vpn fill:#f7fff7,stroke:#2b7,stroke-width:2px;
classDef internal fill:#f7f7ff,stroke:#66f,stroke-width:1px;

class VPS,NPM,SSHD public;
class WGvps,WGpve vpn;
class PVE,VM100,VM101,VM104 internal;